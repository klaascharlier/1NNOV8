<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1NNOV8</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="data.js"></script>
    <script src="field.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.js"></script>
    <script src="ion.rangeSlider-2.1.2/js/ion-rangeSlider/ion.rangeSlider.min.js"></script>
    <link rel="stylesheet" type="text/css" href="filter.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="ion.rangeSlider-2.1.2/css/ion.rangeSlider.css">
    <link rel="stylesheet" type="text/css" href="ion.rangeSlider-2.1.2/css/ion.rangeSlider.skinFlat.css">


</head>
<body>

<div id="wrapper">
    <div id="soccerfield">
    </div>
    <div id="menucolumn">
        <div id="sorts" class="button-group">
            <button class="button is-checked" data-sort-by="original-order">Referees</button>
            <button class="button" data-sort-by="symbol">Teams</button>
            <button class="button" data-sort-by="name">Alfabetisch</button>

        </div>
        <div id="isotopeWrapper">
            <div class="isotope" id="isotope">
        </div>
        </div>

    </div>
</div>
<div id="sliderDiv">
    <input type="text" id="example_id" name="example_name" value="" />
</div>
</body>

<script>

    var svg = d3.select("#soccerfield").append("svg").attr("id", "svg");

    drawField(window.innerHeight - 80);
    getData(11, 15);    //This method must be executed, otherwise things that depend on data will not be executed

    $(document).ready(function (){
        $(window).trigger('resize');
    });

    $(window).on('resize', function(){
        drawField(window.innerHeight - 80);
        $("#isotopeWrapper").css("height", window.innerHeight - 80 - 34 - 8);
        $("#soccerfield").css("height", window.innerHeight - 80);
        $("#soccerfield").css("width", (window.innerHeight - 80) * 360/225);
        $("#wrapper").css("width", (window.innerWidth - 16));
        var soccerWidth = (window.innerHeight - 80) * 360/225;
        var wrapperWidth = (window.innerWidth - 16);
        $("#menucolumn").css("width", wrapperWidth - soccerWidth - 8);
        $("#isotopeWrapper").css("width", wrapperWidth - soccerWidth - 8);
        $("#sorts").css("width", wrapperWidth - soccerWidth - 8);
        drawRefereeData(getFaults("L Mason"));
    });

    $("#example_id").ionRangeSlider({
        type: "double",
        min: 2011,
        max: 2015,
        from: 2011,
        to: 2015
    });

    document.addEventListener("dataReady", function (e) {   //All things that depend on data should be called from here;
        var referees = getReferees();

        var div = document.getElementById("isotope");

        for (var i = 0; i < referees.length; i++) {
            div.innerHTML = div.innerHTML + "<div class='element-item transition' onclick='drawRefereeData(getFaults(\"" + referees[i] + "\"))' data-category='transition'>" +
                    "<h3 class='name'>" + referees[i] + "</h3>" +
                    "<p class='symbol'>R</p>" +
                    "</div>";
        }

        console.log(getFaults("M Atkinson"));
        drawRefereeData(getFaults("L Mason"));

        //drawRefereeData(getDataOfReferee("M Atkinson"));

        var teams = getTeams();

        for(var i = 0; i< teams.length; i++){
            div.innerHTML = div.innerHTML + "<div class='element-item diatomic' data-category='diatomic'>" +
                    "<h3 class='name'>" + teams[i] + "</h3>" +
                    "<p class='symbol'>T</p>" +
                    "</div>";
        }

        console.log(getFaults("M Atkinson"));

        sortInit();
    });


    var activeMenu = "none";
    var activeReferee = "none";
    var menuItems = ["teams", "referees", "something else", "eijfao", "fee", "teams", "referees", "something else", "eijfao", "fee",];

    var options = [];

    var teamsList = [];
    d3.text("1516.csv", "text/csv", function (unParsedData) {  //Alles met data binnen deze scope
        Data = d3.csv.parse(unParsedData);

        //gets the unique teams
        var teams = [];
        Data.forEach(function(d) {
            var found = false;
            for(var i = 0; i<teams.length; i++){
                if(teams[i] == d.HomeTeam){
                    found = true;
                }
            }
            if(!found){
                teams.push(d.HomeTeam);
            }
        });
        teamsList = teams;
        console.log(teams);
    });

    function showOptions() {
        for (i = 0; i < options.length; i++) {
            options[i].attr("visibility", "visible");
        }
    }

    function hideOptions() {
        for (i = 0; i < options.length; i++) {
            options[i].attr("visibility", "hidden");
        }
    }

    var homeText = svg.append("text")
            .attr("x", dimensions.width * 0.05)
            .attr("y", dimensions.height * 0.1)
            .text(function(){
                return "HOME";
            })
            .attr("font-family", "sans-serif")
            .attr("font-size", "40px")
            .attr("font-weight", "bold")
            .attr("fill", "white");
    var awayText = svg.append("text")
            .attr("x", dimensions.width * 0.83)
            .attr("y", dimensions.height * 0.1)
            .text(function(){
                return "AWAY";
            })
            .attr("font-family", "sans-serif")
            .attr("font-size", "40px")
            .attr("font-weight", "bold")
            .attr("fill", "white");

    function sortInit() {
        // init Isotope
        var $container = $('.isotope').isotope({
            itemSelector: '.element-item',
            layoutMode: 'fitRows',
            getSortData: {
                name: '.name',
                symbol: '.symbol',
                category: '[data-category]',
                weight: function (itemElem) {
                    var weight = $(itemElem).find('.weight').text();
                    return parseFloat(weight.replace(/[\(\)]/g, ''));
                }
            }
        });

        // bind sort button click
        $('#sorts').on('click', 'button', function () {
            var sortByValue = $(this).attr('data-sort-by');
            $container.isotope({sortBy: sortByValue});
        });

    }

</script>

</html>