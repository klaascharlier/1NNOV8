<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1NNOV8</title>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="data.js"></script>
    <script src="field.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.js"></script>
    <script src="jquery-ui-1.11.4.custom/jquery-ui.min.js"></script>
    <script src="jQRangeSlider-5.7.2/jQRangeSlider-min.js"></script>
    <link rel="stylesheet" href="jQRangeSlider-5.7.2/css/iThing-min.css" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="filter.css">
    <link rel="stylesheet" type="text/css" href="style.css">


</head>
<body bgcolor="gray">

<div id="container" style="background-color: lavender; padding: 8px; margin: auto">
    <div id="wrapper">
        <div id="soccerfield">
        </div>
        <div id="menucolumn">
            <div id="sorts" class="button-group">
                <button class="button is-checked" data-sort-by="name">Alfabetisch</button>
                <button class="button" data-sort-by="ratio">Ratio</button>
            </div>
            <div class="isotopeWrapper">
                <div class="isotope" id="isotope">
                </div>
            </div>
        </div>
    </div>
    <div id="slider">
    </div>
</div>
</body>

<script>

    var svg = d3.select("#soccerfield").append("svg").attr("id", "svg");
    var selectedReferee = [];
    var $container;
    var $sortBy = "name"
    drawField(window.innerHeight - 80);
    loadData(11, 15);    //This method must be executed, otherwise things that depend on data will not be executed

    $(document).ready(function (){
        $(window).trigger('resize');
    });

    $(window).on('resize', function () {
        var fieldWidth = $("#soccerfield").width();
        drawField(fieldWidth);
        var columnHeight = $("#soccerfield").height();
        $("#wrapper").css("height", columnHeight);
        $("#menucolumn").css("height", columnHeight);
        $(".isotopeWrapper").css("height", columnHeight - $("#sorts").height());
        $(".element-item").css("height", $(".element-item").width());
        drawAvgData(avgFaultsRatio());
        if(selectedReferee.length > 1) {
            for (var i = 0; i < selectedReferee.length; i++) {
                drawRefereeData(getFaults(selectedReferee[i]), 0, i);
             //   console.log(selectedReferee[i]);
            }
        }else{
            drawRefereeData(getFaults(selectedReferee), 1, 0);
            console.log(selectedReferee);
        }


    });

    $("#slider").rangeSlider({
        bounds: {min: 2011, max: 2015.99},
        defaultValues: {min: 2011, max: 2015.99},
        arrows: false,
        formatter:function(val){
            return Math.floor(val);
        }
    });

    $("#slider").bind("valuesChanged", function (e, data) {
        var min = data.values.min.toString().slice(2, 4);
        var max = data.values.max.toString().slice(2, 4);
        console.log(data.values.min);
        console.log(min);
        console.log(max);
        console.log(parseInt(min));
        loadData(parseInt(min), parseInt(max));

    });

    document.addEventListener("dataReady", function (e) {   //All things that depend on data should be called from here;
        var referees = getReferees();
           for(var i = 0; i < referees.length; i++) {
                selectedReferee.push(referees[i]);
           }
        var div = document.getElementById("isotope");
        div.innerHTML = "";
        for (var i = 0; i < referees.length; i++) {
            var color;
            if(referees[i] == selectedReferee[i]){
                color = "halogen";
                console.log("true");
            }
            else{
                color = "transition";
                console.log("false");
            }

            div.innerHTML = div.innerHTML + "<div class='element-item " + color + "' ratio='" + getFaults(referees[i]).avgRatio.toString().slice(0, 4) + "' onclick='changeReferee(\"" + referees[i] + "\")' data-category='transition'>" +
                    "<h3 class='name'>" + referees[i] + "</h3>" +
                    "</div>";
           // console.log(selectedReferee);
        }

        $('#isotope').on('click', 'div', function(){
            if(event.ctrlKey)
            {
                    $(this).removeClass("transition");
                    $(this).addClass("halogen");
                if(selectedReferee.length == 30){
                    alert("You can not selected more than 30 referees!");
                    console.log("10: " + selectedReferee.length);
                }
                if(selectedReferee.length >30){
                    console.log("groter dan 10 : " + selectedReferee.length);
                    $('#isotope').find('.halogen').removeClass('halogen').addClass('transition');
                    $(this).removeClass("transition");
                    $(this).addClass("halogen");
                    //TODO
                    // fix some bug
                    selectedReferee=[];
                    clearLegende();
                    clearRefCirclesFromSVG();
                }

            }
            else
            {
                $('#isotope').find('.halogen').removeClass('halogen').addClass('transition');
                $(this).removeClass("transition");
                $(this).addClass("halogen");
            }
        })

        $(window).trigger('resize');
       sortInit();

    });

    var options = [];

    function showOptions() {
        for (i = 0; i < options.length; i++) {
            options[i].attr("visibility", "visible");
        }
    }

    function hideOptions() {
        for (i = 0; i < options.length; i++) {
            options[i].attr("visibility", "hidden");
        }
    }

    function changeReferee(newReferee) {
        var j;
        var color;
        if(selectedReferee.length != 1){
             color = selectedReferee.length;
        }else{
             color = 0;
        }
        if(event.ctrlKey) {
            j = 0;
            color = selectedReferee.length;
            selectedReferee.push(newReferee);

        }else{
            j = 1;
            color = 0;
            selectedReferee=[];
            selectedReferee.push(newReferee);
            clearLegende();
         }
            drawRefereeData(getFaults(selectedReferee[selectedReferee.length-1]),j, color);
            console.log("kleur: " + color);
    }



    function sortInit() {
        // init Isotope
        if($container != null) {
            $container.isotope('destroy');
        }

        $container = $('.isotope').isotope({
            itemSelector: '.element-item',
            layoutMode: 'fitRows',
            getSortData: {
                name: '.name',
                ratio: '[ratio] parseFloat'
            },
            sortBy: $sortBy
        });

        // bind sort button click
        $('#sorts').on('click', 'button', function () {
            $sortBy = $(this).attr('data-sort-by');
            $container.isotope({sortBy: $sortBy});
        });

        $('.button-group').each(function (i, buttonGroup) {
            var $buttonGroup = $(buttonGroup);
            $buttonGroup.on('click', 'button', function () {
                $buttonGroup.find('.is-checked').removeClass('is-checked');
                $(this).addClass('is-checked');
            });
        });
    }

</script>

</html>